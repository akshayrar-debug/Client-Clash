<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Client Clash</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;900&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #111827; /* bg-gray-900 */
            color: #f3f4f6; /* text-gray-200 */
            padding-top: 120px; /* Increased space for the fixed scoreboard and timer */
        }
        .game-board {
            background-color: #1f2937; /* bg-gray-800 */
            border: 1px solid #374151; /* border-gray-700 */
        }
        .btn {
            transition: all 0.2s ease-in-out;
        }
        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
        }
        .btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }
        .page {
            display: none;
        }
        .page.active {
            display: block;
        }
        .kpi-list-item {
            background-color: #374151;
            padding: 0.75rem;
            border-radius: 0.5rem;
            font-weight: 500;
        }
        .team-name-input {
            background-color: #374151;
            border: 1px solid #4b5563;
            color: white;
            padding: 2px 4px;
            border-radius: 4px;
            width: 120px;
        }
        .team-card.active {
             box-shadow: 0 0 15px rgba(59, 130, 246, 0.7);
             border-color: #3b82f6;
        }
    </style>
</head>
<body class="flex items-center justify-center min-h-screen p-4 relative">

    <!-- Scoreboard Bar -->
    <div id="scoreboard-bar" class="absolute top-0 left-0 right-0 bg-gray-900/80 backdrop-blur-sm border-b border-gray-700 p-4 z-20">
        <div class="w-full max-w-7xl mx-auto flex items-center gap-4">
            <div id="teams-container" class="flex items-center gap-4"></div>
            <button id="add-team-btn" class="btn bg-green-600 hover:bg-green-700 text-white font-bold py-2 px-4 rounded-md text-sm">Add Team</button>
        </div>
    </div>

    <!-- Independent Timer -->
    <div id="timer-container" class="absolute top-24 right-4 game-board p-4 rounded-2xl shadow-lg flex items-center space-x-4 z-10">
        <div id="timer-display" class="text-5xl text-red-500 font-black">60</div>
        <div class="flex flex-col space-y-2">
            <button id="timer-start-btn" class="btn bg-green-600 hover:bg-green-700 text-white font-bold py-1 px-3 rounded-md text-sm">Start</button>
            <button id="timer-stop-btn" class="btn bg-yellow-500 hover:bg-yellow-600 text-black font-bold py-1 px-3 rounded-md text-sm">Stop</button>
            <button id="timer-reset-btn" class="btn bg-red-600 hover:bg-red-700 text-white font-bold py-1 px-3 rounded-md text-sm">Reset</button>
        </div>
    </div>

    <div id="app" class="w-full max-w-7xl mx-auto">
        <!-- Header -->
        <header class="text-center mb-6 pt-4">
            <h1 class="text-5xl font-extrabold text-transparent bg-clip-text bg-gradient-to-r from-blue-400 to-purple-500">Client Clash</h1>
            <p class="text-gray-400 mt-2">The Ultimate Game for CS and PM Professionals</p>
        </header>

        <!-- Main Content -->
        <main id="game-container">
            <!-- Main Menu Page -->
            <div id="main-menu-page" class="page active">
                <div class="game-board p-6 rounded-2xl shadow-2xl text-center">
                    <h2 class="text-3xl font-bold mb-6">Choose a Game</h2>
                    <div id="message-area" class="my-4 h-6 font-semibold"></div>
                    <div class="flex flex-col sm:flex-row space-y-4 sm:space-y-0 sm:space-x-4 justify-center">
                        <button data-round="1" class="navigate-btn btn bg-blue-600 hover:bg-blue-700 text-white font-bold py-3 px-8 rounded-lg text-xl shadow-lg">EMEA Feud</button>
                        <button data-round="3" class="navigate-btn btn bg-teal-600 hover:bg-teal-700 text-white font-bold py-3 px-8 rounded-lg text-xl shadow-lg">KPI Identifier</button>
                        <button data-round="2" class="navigate-btn btn bg-purple-600 hover:bg-purple-700 text-white font-bold py-3 px-8 rounded-lg text-xl shadow-lg">Fastest Finger First</button>
                    </div>
                </div>
            </div>

            <!-- Instructions Page -->
            <div id="instructions-page" class="page">
                <div class="game-board p-6 rounded-2xl shadow-2xl text-center">
                    <h2 id="instructions-title" class="text-3xl font-bold mb-4"></h2>
                    <div id="instructions-text" class="text-lg text-left text-gray-300 max-w-3xl mx-auto mb-6 space-y-2"></div>
                    <div id="loading-state-instructions" class="hidden my-4">
                        <svg class="animate-spin h-8 w-8 text-blue-400 mx-auto" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0-0 24 24">
                            <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                            <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                        </svg>
                        <p class="mt-2 text-lg text-gray-300">AI is generating your game... Please wait.</p>
                    </div>
                    <button id="start-game-btn" class="btn bg-green-600 hover:bg-green-700 text-white font-bold py-3 px-8 rounded-lg text-xl shadow-lg">Start Game</button>
                </div>
            </div>

            <!-- Game Page -->
            <div id="game-page" class="page">
                 <div id="game-content-wrapper" class="game-board p-6 rounded-2xl shadow-2xl">
                    <!-- Game Content (Dynamically populated) -->
                    <div id="game-content"></div>
                     <div class="text-center mt-6">
                        <button id="back-to-menu-btn" class="btn bg-red-700 hover:bg-red-800 text-white font-bold py-2 px-6 rounded-lg">Back to Menu</button>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <script type="module">
        document.addEventListener('DOMContentLoaded', () => {
            // --- DOM ELEMENTS ---
            const pages = {
                mainMenu: document.getElementById('main-menu-page'),
                instructions: document.getElementById('instructions-page'),
                game: document.getElementById('game-page'),
            };
            const gameContent = document.getElementById('game-content');
            const loadingState = document.getElementById('loading-state-instructions');
            const messageArea = document.getElementById('message-area');
            const backToMenuBtn = document.getElementById('back-to-menu-btn');
            const timerDisplay = document.getElementById('timer-display');
            const timerStartBtn = document.getElementById('timer-start-btn');
            const timerStopBtn = document.getElementById('timer-stop-btn');
            const timerResetBtn = document.getElementById('timer-reset-btn');
            const teamsContainer = document.getElementById('teams-container');
            const addTeamBtn = document.getElementById('add-team-btn');
            const instructionsTitle = document.getElementById('instructions-title');
            const instructionsText = document.getElementById('instructions-text');
            const startGameBtn = document.getElementById('start-game-btn');

            // --- GAME STATE ---
            let gameState = {
                gameData: null,
                currentRound: 0,
                questionIndex: 0,
                activeTeamIndex: 0,
                teams: [
                    { name: 'Team 1', score: 0 },
                    { name: 'Team 2', score: 0 }
                ]
            };
            let timerInterval;
            let timeLeft = 60;
            let roundTimerInterval;

            const INSTRUCTIONS = {
                1: { title: "EMEA Feud", text: `
                    <p><strong>Objective:</strong> A case study of a potential client will be presented. Your team's goal is to uncover the client's key pain points by guessing the 5 most critical questions an AI has identified.</p>
                    <ul class="list-disc list-inside mt-2 space-y-1">
                        <li>Your team has <strong>2 minutes</strong> to discuss the case study.</li>
                        <li>After discussion, your team gets <strong>5 attempts</strong> to guess the critical questions.</li>
                        <li>If your team makes <strong>2 wrong attempts</strong>, the turn passes to the next team for a steal.</li>
                        <li><strong>Scoring:</strong>
                            <ul class="list-disc list-inside ml-4">
                                <li><strong>10 points</strong> for every correct question.</li>
                                <li><strong>40 bonus points</strong> if your team correctly guesses all 5 questions.</li>
                                <li><strong>30 bonus points</strong> if another team successfully steals and completes the set of 5 questions.</li>
                            </ul>
                        </li>
                    </ul>` },
                2: { title: "Fastest Finger First", text: `
                    <p><strong>Objective:</strong> Test your quick calculation and knowledge of key metrics.</p>
                    <ul class="list-disc list-inside mt-2">
                        <li>The first team to use the buzzer gets <strong>5 seconds</strong> to answer.</li>
                        <li>A correct answer earns <strong>40 points</strong>.</li>
                        <li>A wrong answer deducts <strong>20 points</strong>.</li>
                        <li>Questions are not passed to other teams.</li>
                    </ul>` },
                3: { title: "KPI Identifier", text: `
                    <p><strong>Objective:</strong> Analyze a sponsor/champion persona and identify their relevant KPIs.</p>
                     <ul class="list-disc list-inside mt-2">
                        <li>You have <strong>1 minute</strong> to guess all relevant KPIs for the stakeholder.</li>
                        <li>The AI will identify the top 6 KPIs. Every correct guess earns <strong>10 points</strong>.</li>
                        <li>You can use a <strong>Joker</strong> to double your points if you think you can guess all 6 correctly.</li>
                    </ul>` }
            };

            // --- SCOREBOARD LOGIC ---
            function renderScoreboard() {
                teamsContainer.innerHTML = '';
                gameState.teams.forEach((team, index) => {
                    const teamEl = document.createElement('div');
                    teamEl.className = 'team-card flex items-center gap-2 bg-gray-800 p-2 rounded-lg border-2 border-transparent transition-all';
                    if (index === gameState.activeTeamIndex) {
                        teamEl.classList.add('active');
                    }
                    
                    const nameSpan = document.createElement('span');
                    nameSpan.className = 'font-bold cursor-pointer';
                    nameSpan.textContent = team.name;
                    nameSpan.addEventListener('click', () => {
                        const input = document.createElement('input');
                        input.type = 'text';
                        input.value = team.name;
                        input.className = 'team-name-input';
                        nameSpan.replaceWith(input);
                        input.focus();
                        input.addEventListener('blur', () => {
                            if (input.value.trim()) {
                                gameState.teams[index].name = input.value.trim();
                            }
                            renderScoreboard();
                        });
                        input.addEventListener('keydown', e => { if (e.key === 'Enter') input.blur(); });
                    });

                    const scoreSpan = document.createElement('span');
                    scoreSpan.className = 'text-2xl font-black text-yellow-300 w-12 text-center';
                    scoreSpan.textContent = team.score;

                    const plusBtn = document.createElement('button');
                    plusBtn.className = 'btn bg-green-500 text-white rounded-full h-6 w-6 flex items-center justify-center';
                    plusBtn.textContent = '+';
                    plusBtn.addEventListener('click', () => {
                        gameState.teams[index].score += 10;
                        renderScoreboard();
                    });

                    const minusBtn = document.createElement('button');
                    minusBtn.className = 'btn bg-red-500 text-white rounded-full h-6 w-6 flex items-center justify-center';
                    minusBtn.textContent = '-';
                    minusBtn.addEventListener('click', () => {
                        gameState.teams[index].score -= 10;
                        renderScoreboard();
                    });

                    teamEl.appendChild(nameSpan);
                    teamEl.appendChild(minusBtn);
                    teamEl.appendChild(scoreSpan);
                    teamEl.appendChild(plusBtn);
                    teamsContainer.appendChild(teamEl);
                });
            }

            addTeamBtn.addEventListener('click', () => {
                gameState.teams.push({ name: `Team ${gameState.teams.length + 1}`, score: 0 });
                renderScoreboard();
            });

            // --- NAVIGATION ---
            function showPage(pageName) {
                Object.values(pages).forEach(page => page.classList.remove('active'));
                pages[pageName].classList.add('active');
            }
