<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Client Clash</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;900&display=swap" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/tone/14.7.77/Tone.min.js"></script>
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #111827; /* bg-gray-900 */
            color: #f3f4f6; /* text-gray-200 */
        }
        .game-board {
            background-color: #1f2937; /* bg-gray-800 */
            border: 1px solid #374151; /* border-gray-700 */
        }
        .btn {
            transition: all 0.2s ease-in-out;
        }
        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
        }
        .btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }
        .kpi-box {
            background-color: #111827;
            border-top: 2px solid #374151;
        }
        .modal {
            background-color: rgba(0,0,0,0.7);
        }
        .modal-content {
            background-color: #1f2937; /* bg-gray-800 */
        }
    </style>
</head>
<body class="flex items-center justify-center min-h-screen p-4 relative">

    <div id="app" class="w-full max-w-7xl mx-auto">
        <!-- Header -->
        <header class="text-center mb-6 pt-4">
            <h1 class="text-5xl font-extrabold text-transparent bg-clip-text bg-gradient-to-r from-blue-400 to-purple-500">Client Clash</h1>
            <p class="text-gray-400 mt-2">The Ultimate Game for CS and PM Professionals</p>
        </header>

        <!-- Main Content -->
        <main id="game-container" class="grid grid-cols-1">
            <!-- Game Board -->
            <div id="game-board" class="game-board p-6 rounded-2xl shadow-2xl">
                <!-- Initial State -->
                <div id="initial-screen" class="text-center flex flex-col items-center justify-center h-full">
                    <h2 class="text-3xl font-bold mb-4">Choose a Persona to Analyze</h2>
                    <div id="message-area" class="my-4 h-6 font-semibold"></div>
                    <div id="loading-state" class="hidden my-4">
                        <svg class="animate-spin h-8 w-8 text-blue-400 mx-auto" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                            <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                            <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                        </svg>
                        <p class="mt-2 text-lg text-gray-300">AI is analyzing the persona... Please wait.</p>
                    </div>
                    <div id="start-options" class="flex flex-col sm:flex-row space-y-4 sm:space-y-0 sm:space-x-4">
                        <button data-persona="Head of Sales Enablement" class="start-round-btn btn bg-blue-600 hover:bg-blue-700 text-white font-bold py-3 px-8 rounded-lg text-xl shadow-lg">Sales Enablement</button>
                        <button data-persona="VP of Customer Success" class="start-round-btn btn bg-purple-600 hover:bg-purple-700 text-white font-bold py-3 px-8 rounded-lg text-xl shadow-lg">Customer Success</button>
                        <button data-persona="Chief Information Officer" class="start-round-btn btn bg-teal-600 hover:bg-teal-700 text-white font-bold py-3 px-8 rounded-lg text-xl shadow-lg">IT / CIO</button>
                    </div>
                </div>

                <!-- Game Content (Dynamically populated) -->
                <div id="game-content" class="hidden"></div>
            </div>
        </main>
    </div>

    <script type="module">
        document.addEventListener('DOMContentLoaded', () => {
            // --- DOM ELEMENTS ---
            const initialScreen = document.getElementById('initial-screen');
            const gameContent = document.getElementById('game-content');
            const loadingState = document.getElementById('loading-state');
            const startOptions = document.getElementById('start-options');
            const messageArea = document.getElementById('message-area');

            // --- GAME STATE ---
            let gameState = {};

            // --- SOUNDS ---
            let sounds = {};
            function initializeSounds() {
                sounds = {
                    success: new Tone.Synth({ oscillator: { type: "triangle" }, envelope: { attack: 0.01, decay: 0.2, sustain: 0.1, release: 0.2 } }).toDestination(),
                };
            }

            // --- EVENT LISTENERS ---
            document.querySelectorAll('.start-round-btn').forEach(button => {
                button.addEventListener('click', (e) => {
                    const persona = e.currentTarget.dataset.persona;
                    startNewAnalysis(persona);
                });
            });
            
            // --- GAME FLOW FUNCTIONS ---
            async function startNewAnalysis(persona) {
                loadingState.classList.remove('hidden');
                startOptions.classList.add('hidden');
                if (Object.keys(sounds).length === 0) {
                    await Tone.start();
                    initializeSounds();
                }

                try {
                    const personaData = await fetchSponsorInfo(persona);
                    if (!personaData) throw new Error("AI failed to generate persona data.");
                    
                    gameState.personaData = personaData;
                    renderPersonaScreen();
                    sounds.success.triggerAttackRelease("C5", "8n");

                } catch (error) {
                    console.error("Error starting new analysis:", error);
                    showMessage("Failed to analyze persona. Please try again.", true);
                    showInitialScreen();
                }
            }
            
            function showInitialScreen() {
                initialScreen.classList.remove('hidden');
                gameContent.classList.add('hidden');
                loadingState.classList.add('hidden');
                startOptions.classList.remove('hidden');
            }

            // --- RENDERING FUNCTIONS ---
            function renderPersonaScreen() {
                if (!gameState || !gameState.personaData) {
                    showInitialScreen();
                    return;
                }
                
                initialScreen.classList.add('hidden');
                loadingState.classList.add('hidden');
                gameContent.classList.remove('hidden');

                const { role, description, kpis } = gameState.personaData;

                const kpiListHTML = kpis.map(kpi => `<li class="bg-gray-700 p-3 rounded-lg">${kpi}</li>`).join('');

                gameContent.innerHTML = `
                    <div class="flex flex-col h-full">
                        <div class="flex-grow p-4">
                            <h2 class="text-4xl font-bold text-center text-yellow-300 mb-4">${role}</h2>
                            <p class="text-lg text-gray-300 text-center max-w-4xl mx-auto">${description}</p>
                        </div>
                        <div class="kpi-box mt-6 p-6 rounded-b-2xl">
                            <h3 class="text-2xl font-bold text-center mb-4">Key Performance Indicators (KPIs)</h3>
                            <ul class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4 text-center">
                                ${kpiListHTML}
                            </ul>
                        </div>
                        <div class="text-center mt-6">
                            <button id="back-to-menu-btn" class="btn bg-red-700 hover:bg-red-800 text-white font-bold py-2 px-6 rounded-lg">Back to Menu</button>
                        </div>
                    </div>
                `;

                document.getElementById('back-to-menu-btn').addEventListener('click', showInitialScreen);
            }

            function showMessage(message, isError = false) {
                messageArea.textContent = message;
                messageArea.className = isError ? 'text-red-500 my-4 h-6 font-semibold' : 'text-yellow-300 my-4 h-6 font-semibold';
                setTimeout(() => { messageArea.textContent = ''; }, 4000);
            }

            // --- AI CONTENT GENERATION ---
            async function fetchSponsorInfo(persona) {
                const prompt = `
                    You are an expert in digital adoption and B2B SaaS sales, specializing in the value proposition of Whatfix.
                    A potential enterprise client is being evaluated. Your task is to analyze the key sponsor or champion role of "${persona}".
                    
                    1.  **Role**: State the role title clearly.
                    2.  **Description**: Provide a concise, one-paragraph description of this person's primary responsibilities, challenges, and goals within their organization, specifically focusing on aspects where a Digital Adoption Platform like Whatfix would be relevant.
                    3.  **KPIs**: List 5-7 of their most important Key Performance Indicators (KPIs) that Whatfix could directly and positively impact.

                    Return the response ONLY as a valid JSON object with the keys "role", "description", and "kpis" (which must be an array of strings).
                `;
                
                let chatHistory = [{ role: "user", parts: [{ text: prompt }] }];
                const payload = { contents: chatHistory, generationConfig: { responseMimeType: "application/json" } };
                const apiKey = "YOUR_API_KEY_HERE"; 
                const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-05-20:generateContent?key=${apiKey}`;
                
                if (apiKey === "YOUR_API_KEY_HERE") {
                    showMessage("API Key not set. Using fallback data.", true);
                    return {
                        "role": "Head of Sales Enablement",
                        "description": "The Head of Sales Enablement is responsible for equipping the sales team with the tools, content, and training needed to succeed. Their primary challenge is ensuring consistent adoption of sales software (like Salesforce) and methodologies across a distributed team, reducing ramp-up time for new hires, and ensuring that the sales process is followed correctly to maximize revenue opportunities. They are constantly looking for ways to improve sales productivity and effectiveness.",
                        "kpis": [
                            "Time to First Deal for New Sales Hires",
                            "Salesforce Adoption & Data Entry Accuracy",
                            "Quota Attainment Rate",
                            "Sales Cycle Length",
                            "Lead Conversion Rate",
                            "Content Utilization Rate by Sales Team"
                        ]
                    };
                }

                try {
                    const response = await fetch(apiUrl, { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify(payload) });
                    if (!response.ok) throw new Error(`API request failed with status ${response.status}`);
                    const result = await response.json();
                    const jsonText = result.candidates[0].content.parts[0].text;
                    return JSON.parse(jsonText);
                } catch (error) {
                    console.error("AI content generation failed:", error);
                    showMessage("Could not connect to AI. Using fallback data.", true);
                    return {
                        "role": "VP of Customer Success",
                        "description": "The VP of Customer Success is tasked with ensuring clients receive maximum value from the product, leading to high retention and expansion revenue. They face challenges with user onboarding, feature adoption, and scaling support efforts effectively. Their goal is to create a seamless customer journey, reduce churn, and identify upsell opportunities by demonstrating clear ROI.",
                        "kpis": [
                            "Net Revenue Retention (NRR)",
                            "Customer Churn Rate",
                            "Product/Feature Adoption Rate",
                            "Time to Value (TTV) for New Customers",
                            "Customer Satisfaction Score (CSAT/NPS)",
                            "Expansion MRR"
                        ]
                    };
                }
            }
        });
    </script>
</body>
</html>
